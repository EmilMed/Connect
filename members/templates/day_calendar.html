{% extends 'master.html' %}

{% block content %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    .container {
        font-family: 'Poppins', sans-serif;
        padding: 20px;
        background-color: #f5f5f5;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 20px;
    }
    .header {
        text-align: center;
    }
    .fc-toolbar-title {
        font-size: 24px;
        font-weight: bold;
    }
    #calendar {
        width: 90%; /* Adjusted to make the calendar slightly narrower */
        height: 800px; /* Adjust height to make the calendar longer */
        max-width: 1000px; /* Adjust width to make the calendar narrower */
        margin: 0 auto 20px;
        font-family: 'Poppins', sans-serif;
    }
    .fc-event {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 5px;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .fc-event-title {
        display: inline-block;
    }
    .fc-event .btn {
        margin-left: 10px;
    }
    .btn-primary, .btn-danger {
        background-color: black;
        color:#fff;
        padding: 7px 14px;
        border-radius: 5px;
        font-size: 16px;
        font-weight: bold;
        text-align: center;
        text-decoration: none;
        margin: 5px;
        border: none;
    }
    .btn-danger {
        background-color: #dc3545;
    }
    .calendar-controls {
        display: flex;
        justify-content: space-between;

        max-width: 1000px; /* Adjusted to match the calendar width */
        margin-bottom: 20px;
    }
    .calendar-title {
        font-size: 24px;
        font-weight: bold;
    }
    .fc-event .btn-sm {
        padding: 5px 10px;
        font-size: 14px;
    }
</style>

<div class="container">
    <div class="calendar-controls">
        <div>
            <a href="{% url 'calendar' %}" class="btn btn-primary">Back to Calendar</a>
        </div>
    </div>
    <div id="calendar"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridDay',
        initialDate: '{{ selected_date }}',
        events: JSON.parse('{{ events|escapejs }}'),
        eventContent: function(arg) {
            var deleteButton = document.createElement('button');
            deleteButton.innerHTML = 'Delete';
            deleteButton.classList.add('btn', 'btn-danger', 'btn-sm');
            deleteButton.onclick = function() {
                if (confirm('Are you sure you want to delete this meeting?')) {
                    fetch('{% url "delete_meeting" 0 %}'.replace('0', arg.event.id), {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        }
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              window.location.href = data.redirect_url;
                          } else {
                              alert('Failed to delete meeting');
                          }
                      });
                }
            };

            var eventTitle = document.createElement('span');
            eventTitle.classList.add('fc-event-title');
            eventTitle.innerHTML = arg.event.title;
            
            var eventContainer = document.createElement('div');
            eventContainer.style.display = 'flex';
            eventContainer.style.justifyContent = 'space-between';
            eventContainer.style.alignItems = 'center';
            eventContainer.appendChild(eventTitle);
            eventContainer.appendChild(deleteButton);

            return { domNodes: [eventContainer] };
        }
    });
    calendar.render();
});
</script>
{% endblock %}
